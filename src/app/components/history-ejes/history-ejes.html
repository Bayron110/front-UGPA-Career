<div class="historial-container">
    <h2>📘 Historial de Carreras de Tipo Superior</h2>

    @if (carrerasConEjes.length > 0) {
        <div class="carreras-grid">
            @for (item of carrerasConEjes; track item.carrera.id; let i = $index) {
                <div class="carrera-card">
                    <!-- Header de la tarjeta -->
                    <div class="card-header">
                        <h3>🎓 {{ item.carrera.career?.nombre || "Carrera ID: " + item.carrera.id }}</h3>
                    </div>

                    <!-- Contenido de la tarjeta -->
                    <div class="card-body">
                        <div class="info-item">
                            <span class="info-label">📋 Carrera:</span>
                            <span class="info-value">{{ item.carrera.career?.nombre || "No especificado" }}</span>
                        </div>
                        
                        <div class="info-item">
                            <span class="info-label">🏷️ Tipo:</span>
                            <span class="info-value">{{ item.carrera.typeCareer?.tipo || "No especificado" }}</span>
                        </div>
                        
                        <div class="info-item">
                            <span class="info-label">📅 Inicio:</span>
                            <span class="info-value">{{ item.carrera.fechaActual | date : "dd/MM/yyyy" }}</span>
                        </div>
                        
                        <div class="info-item">
                            <span class="info-label">⏰ Fin:</span>
                            <span class="info-value">{{ item.carrera.fechaFin | date : "dd/MM/yyyy" }}</span>
                        </div>
                    </div>

                    <!-- Botones de acción -->
                    <div class="card-actions">
                        <button 
                            class="btn-action btn-view" 
                            (click)="toggleEjesVisibles(i)"
                            [attr.aria-expanded]="item.ejesVisibles">
                            @if (!item.ejesVisibles) {
                                👁️ Ver Ejes
                            } @else {
                                🔽 Contraer
                            }
                        </button>
                        
                        <button 
                            class="btn-action btn-pdf" 
                            (click)="generarPDFConFormato(i)">
                            📄 PDF
                        </button>
                    </div>

                    @if (item.ejesVisibles) {
                        @if (getEjesOrdenados(item.ejes).length > 0) {
                            <div class="ejes-expandido">
                                @for (eje of getEjesOrdenados(item.ejes); track eje.nivel) {
                                    <div class="nivel-block">
                                        <div class="nivel-title">📚 {{ eje.nivel }}</div>

                                        <div class="ejes-grid">
                                            @if (eje.eje1 && eje.eje1 !== '-') {
                                                <div class="eje-column">
                                                    <h5 class="eje-header">Eje 1</h5>
                                                    <div class="eje-content">
                                                        <div class="eje-description" [innerHTML]="eje.eje1 | ejePipe"></div>
                                                    </div>
                                                </div>
                                            }
                                            
                                            @if (eje.eje2 && eje.eje2 !== '-') {
                                                <div class="eje-column">
                                                    <h5 class="eje-header">Eje 2</h5>
                                                    <div class="eje-content">
                                                        <div class="eje-description" [innerHTML]="eje.eje2 | ejePipe"></div>
                                                    </div>
                                                </div>
                                            }
                                            
                                            @if (eje.eje3 && eje.eje3 !== '-') {
                                                <div class="eje-column">
                                                    <h5 class="eje-header">Eje 3</h5>
                                                    <div class="eje-content">
                                                        <div class="eje-description" [innerHTML]="eje.eje3 | ejePipe"></div>
                                                    </div>
                                                </div>
                                            }
                                            
                                            @if (eje.eje4 && eje.eje4 !== '-') {
                                                <div class="eje-column">
                                                    <h5 class="eje-header">Eje 4</h5>
                                                    <div class="eje-content">
                                                        <div class="eje-description" [innerHTML]="eje.eje4 | ejePipe"></div>
                                                    </div>
                                                </div>
                                            }
                                        </div>
                                    </div>
                                }
                            </div>
                        } @else {
                            <div class="sin-ejes">
                                <p>📝 Esta carrera no tiene ejes disponibles</p>
                            </div>
                        }
                    }
                </div>
            }
        </div>
    } @else {
        <div class="no-carreras">
            <p>📋 No se ha encontrado información de carreras calculadas</p>
        </div>
    }
</div>