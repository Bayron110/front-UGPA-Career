<div class="form-container">
  <h2 class="heading">ğŸ“‹ CalCareers Guardados - Solo Superior</h2>

  @if (calCareers.length > 0) {
    <table class="tabla">
      <thead>
        <tr>
          <th>ID</th>
          <th>Carrera</th>
          <th>Tipo de Carrera</th>
          <th>Fecha Inicio</th>
          <th>Fecha Fin</th>
          <th>Acciones</th>
        </tr>
      </thead>
      <tbody>
        @for (item of calCareers; track item.id) {
          <tr>
            <td>{{ item.id }}</td>
            <td>{{ item.career.nombre }}</td>
            <td>{{ item.typeCareer.tipo }}</td>
            <td>{{ item.fechaActual | date:'shortDate' }}</td>
            <td>{{ item.fechaFin | date:'shortDate' }}</td>
            <td>
              @if (!tieneEjes(item)) {
                <button 
                  class="btn-go" 
                  (click)="seleccionar(item)"
                  title="Asignar ejes a esta carrera">
                  â• Asignar Ejes
                </button>
              } @else {
                <div class="action-buttons-group">
                  <button 
                    class="btn-edit" 
                    (click)="editarEjes(item)" 
                    title="Editar ejes existentes">
                    âœï¸ Editar Ejes
                  </button>
                  <button 
                    class="btn-delete" 
                    (click)="eliminarEjes(item)" 
                    title="Eliminar todos los ejes">
                    ğŸ—‘ï¸ Eliminar Ejes
                  </button>
                </div>
              }
            </td>
          </tr>
        }
      </tbody>
    </table>
  } @else {
    <div class="no-data">
      <p>ğŸ“ No hay registros de tipo Superior guardados todavÃ­a.</p>
    </div>
  }
</div>

<!-- MODAL PARA ASIGNAR/EDITAR EJES -->
@if (showModal) {
  <div class="modal-overlay" (click)="cerrarModal()">
    <div class="modal" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h3>ğŸ¯ {{ modoEdicion ? 'Editar' : 'Configurar' }} Estructura de la Carrera</h3>
        <button type="button" class="close-btn" (click)="cerrarModal()" title="Cerrar">âœ–</button>
      </div>

      @if (carreraSeleccionada) {
        <div class="carrera-info">
          <div class="info-card">
            <h4>ğŸ“š {{ carreraSeleccionada.career.nombre }}</h4>
            <div class="info-details">
              <span class="info-badge">{{ carreraSeleccionada.typeCareer.tipo }}</span>
              <span class="info-text">ID: {{ carreraSeleccionada.id }}</span>
              @if (modoEdicion) {
                <span class="info-badge mode-badge">âœï¸ MODO EDICIÃ“N</span>
              }
            </div>
            <div class="info-dates">
              <small>
                ğŸ“… {{ carreraSeleccionada.fechaActual | date:'shortDate' }} -
                {{ carreraSeleccionada.fechaFin | date:'shortDate' }}
              </small>
            </div>
          </div>
        </div>
      }

      <!-- Indicador de progreso -->
      <div class="progress-indicator">
        <div class="step-counter">
          Configurando: Nivel {{ currentStep + 1 }} de {{ niveles.length }}
        </div>
        <div class="progress-bar">
          <div class="progress-fill" [style.width.%]="((currentStep + 1) / niveles.length) * 100"></div>
        </div>
        <div class="step-indicators">
          @for (nivel of niveles; track $index; let i = $index) {
            <button 
              type="button"
              class="step-btn" 
              [class.active]="i === currentStep"
              [class.completed]="nivel.nombre.trim() !== ''" 
              (click)="goToStep(i)"
              [title]="'Ir al nivel ' + (i + 1)">
              {{ i + 1 }}
            </button>
          }
        </div>
      </div>

      <!-- Formulario de configuraciÃ³n -->
      <div class="modal-body">
        <form (ngSubmit)="onSubmit()" #estructuraForm="ngForm">
          <div class="nivel-section">
            <div class="nivel-header">
              <h4>ğŸ—ï¸ Nivel {{ currentStep + 1 }}</h4>
            </div>

            <!-- Nombre del nivel -->
            <div class="input-group">
              <label [for]="'nivel-' + currentStep">
                <span class="label-icon">ğŸ“</span>
                Nombre del Nivel {{ currentStep + 1 }}:
              </label>
              <textarea 
                [id]="'nivel-' + currentStep" 
                [(ngModel)]="niveles[currentStep].nombre"
                name="nivel_{{ currentStep }}" 
                maxlength="100" 
                placeholder="Ej: Primer Semestre, Nivel BÃ¡sico, AÃ±o 1, etc."
                class="form-textarea nivel-textarea" 
                rows="2"
                required></textarea>
            </div>

            <!-- Ejes del nivel -->
            <div class="ejes-section">
              <h5>ğŸ“Œ Ejes del Nivel (mÃ¡ximo 4)</h5>
              <p class="ejes-hint">Complete al menos un eje para este nivel (use Enter para nueva lÃ­nea)</p>
              <div class="ejes-grid-square">
                @for (eje of niveles[currentStep].ejes; track $index; let ejeIndex = $index) {
                  <div class="eje-card-square">
                    <div class="eje-content">
                      <label [for]="'eje-' + currentStep + '-' + ejeIndex" class="eje-label">
                        <span class="eje-number-badge">{{ ejeIndex + 1 }}</span>
                      </label>
                      <textarea 
                        [(ngModel)]="eje.nombre" 
                        name="eje_{{ currentStep }}_{{ ejeIndex }}"
                        [id]="'eje-' + currentStep + '-' + ejeIndex" 
                        placeholder="Escriba el nombre del eje {{ ejeIndex + 1 }}..."
                        maxlength="200"
                        rows="4"
                        class="form-textarea eje-textarea"></textarea>
                      <div class="char-counter">
                        {{ eje.nombre.length }}/200
                      </div>
                    </div>
                  </div>
                }
              </div>
            </div>
          </div>

          <!-- Botones de navegaciÃ³n y acciÃ³n -->
          <div class="modal-buttons">
            <div class="navigation-buttons">
              <button 
                type="button" 
                class="btn-nav btn-prev" 
                (click)="prevStep()" 
                [disabled]="currentStep === 0"
                title="Ir al nivel anterior">
                â¬…ï¸ Anterior
              </button>
              <button 
                type="button" 
                class="btn-nav btn-next" 
                (click)="nextStep()"
                [disabled]="currentStep === niveles.length - 1"
                title="Ir al siguiente nivel">
                Siguiente â¡ï¸
              </button>
            </div>

            <div class="action-buttons">
              <button 
                type="submit" 
                class="btn-save"
                title="{{ modoEdicion ? 'Actualizar la estructura completa' : 'Guardar la estructura completa' }}">
                {{ modoEdicion ? 'ğŸ’¾ Actualizar Estructura' : 'ğŸ’¾ Guardar Estructura Completa' }}
              </button>
              <button 
                type="button" 
                class="btn-cancel" 
                (click)="cerrarModal()"
                title="Cancelar y cerrar">
                âŒ Cancelar
              </button>
            </div>
          </div>
        </form>
      </div>
    </div>
  </div>
}
